{% extends 'base.html' %} {% block title %} Editorial {% endblock %} {% block
content %}

<style>
  .container {
    padding: 5% 10%;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    row-gap: 2rem;
  }
</style>

<div class="container">
  <h2>Get Published URL</h2>

  <form id="urlForm">
    <label for="urlInput">Enter URL:</label>
    <input type="text" id="urlInput" name="urlInput" required />
    <button type="button" onclick="submitUrl()">Submit</button>
  </form>

  <div id="resultContainer" style="display: none">
    <h3>Result:</h3>
    <p id="linkOutput"></p>
  </div>

  <script>
    function submitUrl() {
      var urlInput = document.getElementById("urlInput").value;

      var postIdMatch = urlInput.match(/post=(\d+)/);
      if (!postIdMatch) {
        alert("Invalid URL format. Please enter a valid URL.");
        return;
      }

      var postId = postIdMatch[1];

      // API call to retrieve Published URL
      fetch(`https://dailyillini.com/wp-json/wp/v2/posts/${postId}`)
        .then((response) => response.json())
        .then((data) => {
          var linkOutput = document.getElementById("linkOutput");
          if (data && data.code === "rest_post_invalid_id") {
            linkOutput.innerHTML = "No publication could be found";
          } else if (data && data.link) {
            linkOutput.innerHTML =
              '<a href="' +
              data.link +
              '" target="_blank">' +
              data.link +
              "</a>";
          } else {
            linkOutput.innerHTML = "Unexpected response from the server";
          }

          // Show the result container
          var resultContainer = document.getElementById("resultContainer");
          resultContainer.style.display = "block";
        })
        .catch((error) => {
          console.error("Error fetching data:", error);
          alert("Error fetching data. Please try again.");
        });
    }
  </script>
</div>

{% endblock %}
