{% extends 'employee_management/ems_base.html' %}

{% block ems_title %}
    Onboard Employee
{% endblock %}

{% block ems_extra_head %}
    <link rel="stylesheet" href="/static/macros/form.css">

    <style>
        .onboard-form {
            gap: 0.5rem;
        }

        .onboard-form-row {
            flex-direction: column;
            align-items: flex-start;
            flex: 1 1 10rem;
        }

        .column-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex-wrap: wrap;
            flex: 1 1 20rem;
        }
    </style>
{% endblock %}

{% import "macros/form.html" as form %}

{% block ems_content %}
<div style="display: flex; flex-direction: row; gap: 2rem; align-items: center;">
    <a href="/ems/employees" style="color: inherit; font-size: 2rem;">
        <i class="bi bi-arrow-left"></i>
    </a>
    <h2>Onboard a New Employee</h2>
</div>

<p>
    Use this form to onboard a new employee that has not worked for IMC in the past. 
    Otherwise, locate the employee and modify them.
</p>

<p>
    Onboarding an employee will create their employee card and send them a one-time link
    via email to complete their personal information. Afterwards, it will create the user's
    IMC Google account. All onboarding notifications will be sent to the brand's employee
    management Slack channel unless the "Notify Me Directly" option is selected, in which case you
    will be notified directly and the channel will not receive any notifications
</p>

<hr>

<section class="section-container">
    {% call form.form(
        id="employeeOnboardForm",
        class="onboard-form",
        enctype="multipart/form-data",
        on_submit="submitEmployeeOnboard(event)"
    ) %}
    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
        <div style="display: flex; flex-direction: row; gap: 0.5rem; flex-wrap: wrap; align-items: flex-start;">
            <div class="column-container">
                <div class="inner-container" style="padding: 0.75rem;">
                    <div class="section-header">
                        <h3 style="margin-bottom: 0">New Hire Information</h3>
                    </div>

                    <hr style="margin-top: 1rem;">

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        {# Name #}
                        <div style="display: flex; flex-direction: row; gap: 1rem; flex-wrap: wrap;">
                            {{ form.text_input(
                                name="first_name",
                                label="First Name",
                                required=true,
                                class="onboard-form-row"
                            ) }}

                            {{ form.text_input(
                                name="last_name",
                                label="Last Name",
                                required=true,
                                class="onboard-form-row"
                            ) }}
                        </div>

                        {# Email & Brand #}
                        <div style="display: flex; flex-direction: row; gap: 1rem; flex-wrap: wrap;">
                            {{ form.text_input( 
                                name="email",
                                label="Illinois Email",
                                required=true,
                                placeholder="NetID@illinois.edu",
                                pattern=".*@illinois\.edu$",
                                class="onboard-form-row"
                            ) }}
                            <div style="display: flex; flex-direction: row; gap: 1rem;">
                                {{ form.select_input( 
                                    name="onboarded_brand",
                                    label="Brand",
                                    options=brand_options,
                                    required=true,
                                    class="onboard-form-row"
                                ) }}
                                {{ form.switch_input(
                                    name="indv_notif",
                                    label="Notify Me Directly",
                                    class="onboard-form-row"
                                ) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center;">
            {{ form.submit_button(text="Send Onboarding Email", label="submit_button") }}
        </div>
    {% endcall %}
</section>

<script>
    async function submitEmployeeOnboard(event) {
      event.preventDefault();
    
      const form = event.target;
      const formData = new FormData(form);
    
      const response = await fetch("/ems/api/employee/onboard/send", {
        method: "POST",
        body: formData,
      });
    
      // Your endpoint returns a redirect on success
      if (response.redirected) {
        window.location.href = response.url;
        return;
      }
    
      // Otherwise show error
      const data = await response.json().catch(() => ({}));
      alert(data.error || "An unknown error occurred.");
    }
    </script>
    
{% endblock %}


