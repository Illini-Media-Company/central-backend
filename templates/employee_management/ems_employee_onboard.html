{% extends 'employee_management/ems_base.html' %}

{% block ems_title %}
    Onboard Employee
{% endblock %}

{% block ems_extra_head %}
    <link rel="stylesheet" href="/static/macros/form.css">

    <style>
        .onboard-form {
            gap: 0.5rem;
        }

        .onboard-form-row {
            flex-direction: column;
            align-items: flex-start;
            flex: 1 1 10rem;
        }

        .column-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex-wrap: wrap;
            flex: 1 1 20rem;
        }
    </style>
{% endblock %}

{% import "macros/form.html" as form %}

{% block ems_content %}
<div style="display: flex; flex-direction: row; gap: 2rem; align-items: center;">
    <a href="/ems/employees" style="color: inherit; font-size: 2rem;">
        <i class="bi bi-arrow-left"></i>
    </a>
    <h2>Onboard a New Employee</h2>
</div>

<p>Enter the first/last name and email to start onboarding.</p>

<hr>

<section class="section-container">
    {% call form.form(
        id="employeeOnboardForm",
        class="onboard-form",
        enctype="multipart/form-data",
        on_submit="submitEmployeeOnboard(event)"
    ) %}
    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
        <div style="display: flex; flex-direction: row; gap: 0.5rem; flex-wrap: wrap; align-items: flex-start;">
            <div class="column-container">
                <div class="inner-container" style="padding: 0.75rem;">
                    <div class="section-header">
                        <h3 style="margin-bottom: 0">New Hire Information</h3>
                    </div>

                    <hr style="margin-top: 1rem;">

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div style="display: flex; flex-direction: row; gap: 1rem; flex-wrap: wrap;">
                            {{ form.text_input(
                                name="first_name",
                                label="First Name",
                                required=true,
                                class="onboard-form-row"
                            ) }}

                            {{ form.text_input(
                                name="last_name",
                                label="Last Name",
                                required=true,
                                class="onboard-form-row"
                            ) }}
                        </div>

                        {{ form.text_input(
                            name="email",
                            label="Email",
                            required=true,
                            class="onboard-form-row"
                        ) }}
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center;">
            {{ form.submit_button(text="Send Onboarding Email", label="submit_button") }}
        </div>
    {% endcall %}
</section>

<script>
    async function submitEmployeeOnboard(event) {
      event.preventDefault();
    
      const form = event.target;
      const formData = new FormData(form);
    
      const response = await fetch("/ems/api/employee/onboard/send", {
        method: "POST",
        body: formData,
      });
    
      // Your endpoint returns a redirect on success
      if (response.redirected) {
        window.location.href = response.url;
        return;
      }
    
      // Otherwise show error
      const data = await response.json().catch(() => ({}));
      alert(data.error || "An unknown error occurred.");
    }
    </script>
    
{% endblock %}


