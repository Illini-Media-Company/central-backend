{% extends 'base.html' %} {% block title %}Employee Agreement Portal{% endblock
%} {% block extra_head %}
<link rel="stylesheet" href="/static/styles/styles_index.css" />
<link rel="stylesheet" href="/static/DI_Contract_Automization.css" />
{% include "partials/loading.html" %} {% include "partials/info_bar.html" %} {%
endblock %} {% block content %}
<header>
  <h1>Employee Agreement Portal</h1>
  <p class="subtitle">Use this page to send and track employee agreements.</p>
</header>

<main class="di-contract-main">
  <!-- LEFT SIDE: Send Form -->
  <section class="left">
    <h2>Send Agreement Form</h2>
    <p class="note">Fill out the fields below to start the contract process.</p>

    <div class="form-group">
      <label for="employee-emails">New Employee Emails</label>
      <textarea
        id="employee-emails"
        placeholder="Enter one email per line&#10;e.g. jdoe@illinimedia.com&#10;asmith@illinimedia.com"
      ></textarea>
      <p class="hint">Tip: Paste multiple emails — one per line.</p>
    </div>

    <div class="form-group">
      <label for="manager-select">Select Manager</label>
      <select id="manager-select">
        <option value="">Select a manager</option>
        <option>Greg Benke</option>
        <option>Joe Shmoe</option>
        <option>Jane Doe</option>
      </select>
    </div>

    <div class="form-group">
      <label for="chief-select">Select Chief</label>
      <select id="chief-select">
        <option value="">Select a chief</option>
        <option>John Smith</option>
        <option>Mary Johnson</option>
      </select>
    </div>

    <button id="send-btn">Send Agreement</button>
  </section>

  <!-- RIGHT SIDE: Manager’s Pending Signatures -->
  <section class="right">
    <h2>Pending Signatures</h2>
    <div class="doc-box">
      <!-- Example active item -->
      <div class="doc-item">
        <h3>Agreement: Jane Doe</h3>
        <p>Status: Awaiting Your Signature</p>
        <button class="sign-btn">Review &amp; Sign</button>
      </div>

      <!-- Example with no pending items -->
      <!-- <p class="no-docs">No pending signatures at this time.</p> -->
    </div>
  </section>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const sendBtn = document.getElementById("send-btn");
  if (!sendBtn) {
    console.error("Send button not found!");
    return;
  }

  sendBtn.addEventListener("click", async () => {
    const emailsText = document.getElementById("employee-emails")?.value || "";
    const emails = emailsText
      .split("\n")
      .map(e => e.trim())
      .filter(e => e);

    const manager = document.getElementById("manager-select")?.value;
    const chief = document.getElementById("chief-select")?.value;

    if (emails.length === 0 || !manager || !chief) {
      alert("Please fill in all required fields before sending.");
      return;
    }

    const payload = { emails, manager, chief };

    try {
      const response = await fetch("/onboarding/send_agreement", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      // Try parsing the response
      const result = await response.json().catch(() => null);

      if (response.ok) {
        alert("Agreements successfully sent!");
        console.log("Server response:", result);

        // Optionally clear form
        document.getElementById("employee-emails").value = "";
        document.getElementById("manager-select").value = "";
        document.getElementById("chief-select").value = "";
      } else {
        alert("Error: " + (result?.message || response.statusText));
      }
    } catch (error) {
      console.error("Error sending agreement:", error);
      alert("Something went wrong. Please try again.");
    }
  });
});
</script>

  
</main>
{% endblock %}
