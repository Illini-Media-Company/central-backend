{% extends 'base.html' %}

{% block title %}
Mini Crossword Admin
{% endblock %}

{% block content %}
<style>
    .container {
        width: 80%;
        margin: 0 auto;
        margin-top: 25px;
    }
    .modifiable-input {
        display: none;
    }
    .modifiable-url-input {
        display: none;
    }
    .table th:nth-child(1),
    .table td:nth-child(1) {
        width: 12.5%; /* Set a fixed width for the Date column */
    }
    .table th:nth-child(2),
    .table td:nth-child(2) {
        width: 15%; /* Set a fixed width for the Word column */
    }
    .table th:nth-child(3),
    .table td:nth-child(3) {
        width: 10%; /* Set a fixed width for the Word column */
    }
    .table th:nth-child(4),
    .table td:nth-child(4) {
        width: 45%; /* Set a fixed width for the Related Story column */
    }
    .table th:nth-child(5),
    .table td:nth-child(5) {
        width: 17.5%; /* Set a fixed width for the Actions column */
    }
    .error-message {
        color: red;
    }

    .crossword-input {
        padding-bottom: 2vh;
    }
    .crossword-row {
        padding: 0;
    }
    .letter {
        height: 10vh;
        width: 10vh;
        font-size: 9vh;
        padding: 0;
    }
    .letter-blacked-out {
        background-color: black;
    }
</style>

<div class="container">
    <div class="d-flex justify-content-center">
        <div class="w-100">
            <h3>Mini Crossword Dashboard</h3>
            <h2>Crossword Creation Instructions: </h2>
            <p>1. Double-click a square to black it out.</p>
            <p>2. Enter all letters before adding clues.</p>
    
            <form onsubmit=onSubmit>
                <div class="crossword-input">
                    {% for r in [0, 1, 2, 3, 4] %}
                    <div class="crossword-row" id="cross-row-{{r}}">
                        {% for c in [0, 1, 2, 3, 4] %}
                        <input type="text" class="letter" maxlength=1 id="cross-box-{{r}}-{{c}}">
                        {% endfor %}
                    </div>
                    {% endfor %}
                </div>
                <input type="button" value="Add Clues" onclick=addClues()>
                <!-- <input type="submit" value="Add Clues"> -->
            </form>
        </div>
    </div>
</div>
<script>
    // set up toggling 
    for (let r = 0; r < 5; r++) {
        for (let c = 0; c < 5; c++) {
            let id = "cross-box-" + String(r) + "-" + String(c);
            document.getElementById(id).addEventListener('dblclick', function() {
                this.classList.toggle('letter-blacked-out');
                if (this.getAttribute("maxlength") == 0) {
                    this.setAttribute("maxlength", 1);
                } else {
                    this.setAttribute("maxlength", 0);
                }
            });
        }
    }

    function addClues() {
        const puzzle = [["-", "-", "-", "-", "-"], 
                      ["-", "-", "-", "-", "-"], 
                      ["-", "-", "-", "-", "-"], 
                      ["-", "-", "-", "-", "-"], 
                      ["-", "-", "-", "-", "-"]];
        for (let r = 0; r < 5; r++) {
            for (let c = 0; c < 5; c++) {
                let letter = document.getElementById("cross-box-" + String(r) + "-" + String(c));
                if (letter.value.length == 1) {
                    puzzle[r][c] = String(letter.value);
                }
            }
        }
        console.log(puzzle);

        const acrossClues = [];
        console.log(acrossClues);
        for (let r = 0; r < 5; r++) {
            let word = "";
            for (let c = 0; c < 5; c++) {
                if ((puzzle[r][c] == "-" || c == 4) && word != "") {
                    if (c == 4) {
                        word += puzzle[r][c];
                    }
                    acrossClues.push(word);
                    word = "";
                } else if (puzzle[r][c] != "-") {
                    word += puzzle[r][c]
                }
                console.log("cp4");
            }
        }

        let downClues = [];
        for (let c = 0; c < 5; c++) {
            let word = "";
            for (let r = 0; r < 5; r++) {
                if ((puzzle[r][c] == "-" || r == 4) && word != "") {
                    if (r == 4) {
                        word += puzzle[r][c];
                    }
                    downClues.push(word);
                    word = "";
                } else if (puzzle[r][c] != "-") {
                    word += puzzle[r][c]
                }
            }
        }

        console.log(acrossClues);
        console.log(downClues);
        
        // Create a new form dynamically
        const form = document.createElement("form");
        form.id = "clue-form";
        form.style.marginTop = "25px";

        const header = document.createElement("h3");
        header.innerText = "Add Clues";
        form.appendChild(header);

        // Across clues
        if (acrossClues.length > 0) {
            const acrossHeader = document.createElement("h4");
            acrossHeader.innerText = "Across";
            form.appendChild(acrossHeader);

            acrossClues.forEach((word, i) => {
                const label = document.createElement("label");
                label.innerText = `${i + 1}. ${word}: `;
                const input = document.createElement("input");
                input.type = "text";
                input.name = `across-${word}`;
                input.placeholder = `Clue for ${word}`;
                input.style.marginBottom = "10px";
                input.style.width = "60%";
                form.appendChild(label);
                form.appendChild(input);
                form.appendChild(document.createElement("br"));
            });
        }

        if (downClues.length > 0) {
            const downHeader = document.createElement("h4");
            downHeader.innerText = "Down";
            form.appendChild(downHeader);

            downClues.forEach((word, i) => {
                const label = document.createElement("label");
                label.innerText = `${i + 1}. ${word}: `;
                const input = document.createElement("input");
                input.type = "text";
                input.name = `down-${word}`;
                input.placeholder = `Clue for ${word}`;
                input.style.marginBottom = "10px";
                input.style.width = "60%";
                form.appendChild(label);
                form.appendChild(input);
                form.appendChild(document.createElement("br"));
            });
        }
    }
    
</script>

{% endblock %}
